# The raytrace script is generating renderings of models and prints the file names
# This information is parsed by the PHP script and stored in node fields 
# set globing mode; sequence with concat to suppress output of set
set glob_compat_mode 0; concat 

# get parameters sent from Drupal
set image $::env(image); set view $::env(view); set size $::env(size); concat

# zapp the drawing area
Z

# draw all top objects
foreach x [tops] { 
  if {$x != "_GLOBAL"} {
    draw $x
  } 
}

# set the view 
ae $view

# auto zoom to 
autoview

# raytrace the model
rt -s $size -v 0 -o "${image}.pix"